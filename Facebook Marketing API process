1. Goto htttps://Developers.facebook.com and click on Myapps
2. Now Click on create APP
3. Add product like Facebook Login & Marketing API
4. Goto https://developers.facebook.com/tools/explorer/ and click on Generate Access Token
5. put that access token under variable fb_access_token in the below second code block(i.e Query to get FACEBOOK DATA)
6. To install package(deductive/FBinsightR) download RTools 4.2 version 
7. run Install.package(deductive/FBinsightR)
8. Run custom function code(Function to get the required data )
9. Run the code block to fetch the data(Query to get FACEBOOK DATA)


Step8 :-

#############################################################
##Function to get the required data --------   START
#############################################################
# Set functions

###### Function 1 - fbins_ag

#' Get FB insights by age & gender.
#' @description This returns all available FB insights per day including age and gender breakdown to the specified report level, and place into a data frame. When reporting by age and gender the FB API can timeout when reporting on only a few days. This function allows you to pull one day at a time if needed.
#' @param start_date The first full day to report, in the format "YYYY-MM-DD" .
#' @param until_date The last full day to report, in the format "YYYY-MM-DD" .
#' @param report_level One of "ad", "adset", "campaign" or "account" .
#' @param fb_access_token This must be a valid access token with sufficient privileges. Visit the Facebook API Graph Explorer to acquire one.
#' @param account This is the ad account, campaign, adset or ad ID to be queried.
#' @keywords facebook insights api
#' @export
#' @examples
#' fbins_ag("start_date", "until_date", "report_level", "fb_access_token", "account")
#' fbins_ag("2017-01-20", "2017-01-22", "ad", "ABCDEFG1234567890ABCDEFG", "act_12345678")

fbins_ag <- function(start_date, until_date, report_level, fb_access_token, account){
  #set variables
  sstring <- paste0('"','since','"')
  ustring <- paste0('"','until','"')
  #paste together JSON string
  range_content <- paste0(sstring,':','"',start_date,'"',',',ustring,':','"',until_date,'"')
  time_range <- paste0("{",range_content,"}")
  #paste together URL
  api_version <- "v8.0"
  url_stem <- "https://graph.facebook.com/"
  URL <- paste0(url_stem, api_version, "/", account, "/insights")

  #call insights
  content_result <- content(GET(
    URL,
    query = list(
      access_token = fb_access_token,
      time_range = time_range,
      level= report_level,
      fields = "campaign_name, campaign_id, objective, adset_id, adset_name, ad_id, ad_name, impressions, cpm, reach, clicks, inline_link_clicks,unique_clicks, ctr, cpc, unique_ctr, cost_per_unique_click, estimated_ad_recall_rate, cost_per_estimated_ad_recallers, spend, canvas_avg_view_time, canvas_avg_view_percent",
      time_increment="1",
      limit = "1000",
      breakdowns = "age, gender"
    ),
    encode = "json",
    verbose()))

  # Show and return error if exists
  if ("error" %in% names(content_result)){
    message(paste(
      paste0("ERROR ", content_result$error$code, " (",
             content_result$error$type, "):"),
      content_result$error$message
    ))
    # Very useful for Shiny apps
    invisible(return(content_result$error))
  }

  #extract data and name
  result_df <- data.frame(content_result$data %>% reduce(bind_rows))

  # Condition to detect the next page
  if(exists("next", content_result$paging) == TRUE){
    # Checking from the originally returned list
    result <- fromJSON(content_result$paging$`next`)
    result_df <- bind_rows(result_df, as.tibble(result$data))

    # Looping through subsequent returned pages
    while(exists("next", result$paging) == TRUE){
      result <- fromJSON(result$paging$`next`)
      result_df <- bind_rows(result_df, as.tibble(result$data))
    }
  }
  result_df <- result_df
}



STEP 9:-

########################################################################
##Query to get FACEBOOK DATA
########################################################################

account <- "act_paste your account ID"
report_level <- "ad"
fb_access_token<-"paste your generated access token here"

#for(i in 20:30) {
#  # i-th element of `u1` squared into `i`-th position of `usq`
#  d<-1+i
#  print(d)

repeat{

Fb_insight_data <- fbins_ag(start_date, until_date, report_level, fb_access_token, account)

Fb_insight_data

g<-nrow(Fb_insight_data)


if (is.integer(g)){

  break
}

}
nrow(Fb_insight_data)

Fb_insight_data<- Fb_insight_data %>%
mutate(spend = as.numeric(spend),
             clicks = as.numeric(clicks),
             ctr = as.numeric(ctr),
             cpm = as.numeric(cpm),
             cpc = as.numeric(cpc),
             impressions = as.numeric(impressions),
             inline_link_clicks = as.numeric(inline_link_clicks),
             campaign_id = as.factor(campaign_id),
             adset_id = as.factor(adset_id),
             adset_name = as.factor(adset_name),
             ad_id = as.factor(ad_id),
             age = as.factor(age),
             gender = as.factor(gender),
             date_start = as.Date(date_start),
             date_stop = as.Date(date_stop))


